---
title: "final project"
author: "Yixin Zheng"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(skimr)
library(dplyr)
library(ggplot2)
library(caret)
library(corrplot)
```

## Data Cleaning and Preprocessing
```{r data import and initial tidy}
# Import data and clean column names
data <- read.csv("./data/Project_2_data.csv") %>% 
  clean_names()

# Select relevant covariates (variables 1-14) and outcome variable
model_data <- data %>%
  select(
    age, race, marital_status, t_stage, n_stage, x6th_stage, differentiate, grade,
    a_stage, tumor_size, estrogen_status, progesterone_status,
    regional_node_examined, reginol_node_positive, status
  )

# Convert categorical variables to factors and relabel `grade`
model_data <- model_data %>%
  mutate(
    race = factor(race),
    marital_status = factor(marital_status),
    t_stage = factor(t_stage),
    n_stage = factor(n_stage),
    x6th_stage = factor(x6th_stage),
    differentiate = factor(differentiate),
    a_stage = factor(a_stage),
    estrogen_status = factor(estrogen_status),
    progesterone_status = factor(progesterone_status),
    status = factor(status, levels = c("Alive", "Dead")),
    grade = case_when(
      grade == "1" ~ "1",
      grade == "2" ~ "2",
      grade == "3" ~ "3",
      grade == " anaplastic; Grade IV" ~ "4",
      TRUE ~ NA_character_
    ) %>% factor(levels = c("1", "2", "3", "4"))
  )

# Summarize structure of the cleaned dataset
summary(model_data)
```
## Exploratory Data Analysis
### Summary statistics
```{r summary statistics}
# Summary statistics for continuous and categorical variables
skim(model_data)

# Key statistics grouped by survival status
summary_by_status <- model_data %>%
  group_by(status) %>%
  summarise(
    mean_age = mean(age, na.rm = TRUE),
    sd_age = sd(age, na.rm = TRUE),
    mean_tumor_size = mean(tumor_size, na.rm = TRUE),
    sd_tumor_size = sd(tumor_size, na.rm = TRUE),
    prop_white = mean(race == "White", na.rm = TRUE),
    prop_black_other = mean(race != "White", na.rm = TRUE),
    n_obs = n()
  )
print(summary_by_status)
```

### Distribution Visualization
```{r survival status}
# Survival status
ggplot(model_data, aes(x = status, fill = status)) +
  geom_bar(alpha = 0.7, color = "black") +
  scale_fill_manual(values = c("Alive" = "gold", "Dead" = "lightblue")) +
  theme_minimal() +
  labs(
    title = "Distribution of Survival Status",
    x = "Status",
    y = "Count"
  )
```

```{r race}
# Race
ggplot(model_data, aes(x = race, fill = race)) +
  geom_bar(alpha = 0.7, color = "black") +
  scale_fill_manual(values = c("White" = "gold4", "Other" = "gold3", "Black" = "gold2")) +
  theme_minimal() +
  labs(
    title = "Distribution of Race",
    x = "Race",
    y = "Count"
  ) +
  theme(legend.position = "none") 

# Race by survival status
ggplot(model_data, aes(x = race, fill = status)) +
  geom_bar(position = "fill", alpha = 0.7, , color = "black") +
  scale_fill_manual(values = c("Alive" = "gold", "Dead" = "lightblue")) +
  theme_minimal() +
  labs(
    title = "Survival Status by Race",
    x = "Race",
    y = "Proportion"
  )
```

```{r age}
# Age
ggplot(model_data, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "purple", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(
    title = "Age Distribution",
    x = "Age",
    y = "Count"
  )

# Age by survival status
ggplot(model_data, aes(x = status, y = age, fill = status)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_manual(values = c("Alive" = "gold", "Dead" = "lightblue")) +
  theme_minimal() +
  labs(
    title = "Age by Survival Status",
    x = "Status",
    y = "Age"
  )
```

```{r tumor size}
# Tumor size
ggplot(model_data, aes(x = tumor_size)) +
  geom_histogram(binwidth = 10, fill = "pink", alpha = 0.7, color = "black") +
  theme_minimal() +
  labs(
    title = "Tumor Size Distribution",
    x = "Tumor Size (mm)",
    y = "Count"
  )

# Tumor size by survival status
ggplot(model_data, aes(x = status, y = tumor_size, fill = status)) +
  geom_boxplot(alpha = 0.8, color = "black") +
  scale_fill_manual(values = c("Alive" = "gold", "Dead" = "lightblue")) +
  theme_minimal() +
  labs(
    title = "Tumor Size by Survival Status",
    x = "Status",
    y = "Tumor Size (mm)"
  )

# Tumor size by race and survival status
ggplot(model_data, aes(x = race, y = tumor_size, fill = status)) +
  geom_boxplot(alpha = 0.8, color = "black") +
  scale_fill_manual(values = c("Alive" = "gold", "Dead" = "lightblue")) +
  theme_minimal() +
  labs(
    title = "Tumor Size by Race and Survival Status",
    x = "Race",
    y = "Tumor Size (mm)"
  )
```

### Pairwise Relationships and Interactions
```{r}
# Pairwise relationships (correlation matrix for continuous variables)
continuous_vars <- model_data %>%
  select(age, tumor_size, regional_node_examined, reginol_node_positive) %>%
  na.omit()

corrplot(correlation_matrix, method = "circle", 
         type = "upper", tl.col = "black", addCoef.col = "grey", 
         number.cex = 0.8, tl.cex = 0.9)
```
Small circles (near-zero correlations) are observed for age and all other variables; tumor_size and regional_node_examined suggesting weak or no relationships.
`regional_node_positive` is moderately associated with both `tumor size` (0.24) and `regional nodes examined` (0.41), which might influence modeling decisions.
There are no strong correlations (close to Â±1), suggesting no immediate multicollinearity issues among these variables.


